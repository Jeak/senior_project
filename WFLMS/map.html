<!-- WFLMS Map. Loosely based on Google Maps API sample code from https://developers.google.com/maps/documentation/javascript/tutorial. -->
<!-- Bobby Goldie, Jack Gallegos 2020 -->



<!DOCTYPE html>
<html>
  <head>
    <style>
       /* Set the size of the div element that contains the map */
      #map {
        height: 600px;  /* The height is 400 pixels */
        width: 100%;  /* The width is the width of the web page */
       }
    </style>
  </head>
  <body>
    <h3>WFLMS Tracking System</h3>


    <!--The div element for the map -->
    <div id="map"></div>



    <script>

// Import node js tools for file reading
//const fs = require('fs');

// Demo data
var positions = [{"unit_number": 177, "emerg_flg": 0, "fline_stat": 0, "rsrc_stat": 1, "lat": 37.48091470331358, "lon": -122.27905543215411, "rx_time": 1589007919.4916418}, {"unit_number": 522, "emerg_flg": 0, "fline_stat": 0, "rsrc_stat": 1, "lat": 37.48081590557667, "lon": -122.2791129332237, "rx_time": 1589007956.9049203}, {"unit_number": 624, "emerg_flg": 1, "fline_stat": 1, "rsrc_stat": 1, "lat": 37.48086991445299, "lon": -122.27910110396783, "rx_time": 1589007990.4738903}, {"unit_number": 2, "emerg_flg": 1, "fline_stat": 0, "rsrc_stat": 1, "lat": 37.48099616518833, "lon": -122.27911120138216, "rx_time": 1589008024.2166429}];


markers = [];
// Initialize and add the map
// Called upon web page load
function initMap() {

  // The location of the incident
  var incident_pos = {lat:37.481058, lng:-122.279109};
  // The map
  var map = new google.maps.Map(
    // center map at incident positioned
      document.getElementById('map'), {zoom: 15, center: incident_pos});
  // The marker, positioned at Uluru
//  var marker = new google.maps.Marker({position: incident_pos, map: map});


  for (var i = 0; i < positions.length; i++) {
    temp_pos = {lat:positions[i].lat, lng:positions[i].lon };
    var marker = new google.maps.Marker({position: temp_pos, map: map});
    // add markers to array
    let newLength = markers.push(marker);

  }

// delete markers
for (var i = 0; i < markers.length; i++) {
  markers[i].setMap(null);
}

// redraw the markers
for (var i = 0; i < positions.length; i++) {
  temp_pos = {lat:positions[i].lat, lng:positions[i].lon };
  var marker = new google.maps.Marker({position: temp_pos, map: map});
  let newLength = markers.push(marker);

}

  // Plot the location of the devices on the map
 // for element in json array
  // print location on <map>
  // update status table
 // if changes to file update again
  // document.getElementById('unit_statuses').innerHTML = incident_pos.lat;
}
// Create a function to read the data from the file
function getDataFromFile() {



  fs.readFile('./data.json', 'utf8', (err, jsonString) => {
      if (err) {
          console.log("File read failed:", err)
          return
      }
      console.log('File data:', jsonString)
  })

}

function sleep(milliseconds) {
  var start = new Date().getTime();
  for (var i = 0; i < 1e7; i++) {
    if ((new Date().getTime() - start) > milliseconds){
      break;
    }
  }
}


    </script>
    <!--Load the API from the specified URL
    * The async attribute allows the browser to render the page while the API loads
    * The key parameter will contain your own API key (which is not needed for this tutorial)
    * The callback parameter executes the initMap() function
    -->
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB3uvG8Jpki3K7Z1QORHjeP7srsOg1Egj8&callback=initMap">
    </script>

  </body>

<table id="unit_statuses">
</table>
</html>
